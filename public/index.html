<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Volki's Travel Tipps</title>
  <script crossorigin src="https://unpkg.com/react@18.2.0/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone@7.23.5/babel.min.js"></script>
  <script src="https://unpkg.com/lucide@0.263.1/dist/umd/lucide.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {}
      }
    }
  </script>
  <style>
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
        'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
        sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState } = React;
    const { MapPin, Clock, Compass, Search, Star, Navigation, Settings } = lucide;

    function VolkisTravelTipps() {
      const [ort, setOrt] = useState('');
      const [zeitbudget, setZeitbudget] = useState('2h');
      const [interessen, setInteressen] = useState([]);
      const [entfernung, setEntfernung] = useState('mittel');
      const [vorschlaege, setVorschlaege] = useState([]);
      const [loading, setLoading] = useState(false);
      const [apiKey, setApiKey] = useState('');
      const [showApiInput, setShowApiInput] = useState(true);

      const interessenOptionen = [
        { id: 'tourist_attraction', label: 'Sehensw√ºrdigkeiten', icon: 'üèõÔ∏è' },
        { id: 'park', label: 'Natur & Parks', icon: 'üå≥' },
        { id: 'restaurant', label: 'Restaurants', icon: 'üçΩÔ∏è' },
        { id: 'cafe', label: 'Caf√©s', icon: '‚òï' }
      ];

      const toggleInteresse = (id) => {
        setInteressen(prev => 
          prev.includes(id) 
            ? prev.filter(i => i !== id)
            : [...prev, id]
        );
      };

      const sucheVorschlaege = async () => {
        if (!ort.trim()) {
          alert('Bitte einen Ort eingeben');
          return;
        }
        if (interessen.length === 0) {
          alert('Bitte mindestens eine Kategorie ausw√§hlen');
          return;
        }
        if (!apiKey.trim()) {
          alert('Bitte Google API Key eingeben');
          return;
        }

        setLoading(true);
        setVorschlaege([]);

        try {
          const response = await fetch('/api/search', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              ort,
              interessen,
              entfernung,
              apiKey
            })
          });

          const data = await response.json();

          if (data.success && data.results) {
            setVorschlaege(data.results);
          } else {
            alert(data.error || 'Es gab einen Fehler bei der Suche.');
          }
        } catch (error) {
          console.error('Fehler:', error);
          alert('Es gab einen Fehler bei der Suche. Bitte nochmal versuchen.');
        }

        setLoading(false);
      };

      return (
        <div className="min-h-screen bg-neutral-50 p-4 md:p-8">
          <div className="max-w-2xl mx-auto">
            {/* Header */}
            <div className="mb-8">
              <h1 className="text-3xl font-semibold text-neutral-900 mb-2">
                Volki's Travel Tipps
              </h1>
              <p className="text-neutral-600">Entdecke spannende Orte in deiner N√§he</p>
            </div>

            {/* API Key Eingabe */}
            {showApiInput && (
              <div className="bg-white border border-neutral-200 rounded-lg p-4 mb-6">
                <div className="flex items-center gap-2 mb-3">
                  <Settings size={16} className="text-neutral-600" />
                  <h3 className="font-medium text-neutral-900">API Einstellungen</h3>
                </div>
                <p className="text-sm text-neutral-600 mb-3">
                  Google Places API Key eingeben
                </p>
                <input
                  type="text"
                  value={apiKey}
                  onChange={(e) => setApiKey(e.target.value)}
                  placeholder="AIza..."
                  className="w-full px-3 py-2 border border-neutral-300 rounded-md focus:outline-none focus:ring-2 focus:ring-neutral-900 focus:border-transparent mb-2"
                />
                <button
                  onClick={() => setShowApiInput(false)}
                  className="text-sm text-neutral-600 hover:text-neutral-900"
                >
                  Speichern
                </button>
              </div>
            )}

            {/* Suchformular */}
            <div className="bg-white border border-neutral-200 rounded-lg p-6 mb-6">
              {/* Ort */}
              <div className="mb-6">
                <label className="block text-sm font-medium text-neutral-900 mb-2">
                  Ort
                </label>
                <input
                  type="text"
                  value={ort}
                  onChange={(e) => setOrt(e.target.value)}
                  placeholder="z.B. Dresden"
                  className="w-full px-3 py-2 border border-neutral-300 rounded-md focus:outline-none focus:ring-2 focus:ring-neutral-900 focus:border-transparent"
                />
              </div>

              {/* Zeitbudget */}
              <div className="mb-6">
                <label className="block text-sm font-medium text-neutral-900 mb-2">
                  Zeitbudget
                </label>
                <div className="inline-flex rounded-md border border-neutral-200">
                  {['1h', '2h', '3-4h'].map((zeit, idx) => (
                    <button
                      key={zeit}
                      onClick={() => setZeitbudget(zeit)}
                      className={`px-4 py-2 text-sm font-medium ${
                        idx === 0 ? 'rounded-l-md' : ''
                      } ${idx === 2 ? 'rounded-r-md' : ''} ${
                        idx !== 2 ? 'border-r border-neutral-200' : ''
                      } ${
                        zeitbudget === zeit
                          ? 'bg-neutral-900 text-white'
                          : 'bg-white text-neutral-700 hover:bg-neutral-50'
                      }`}
                    >
                      {zeit}
                    </button>
                  ))}
                </div>
              </div>

              {/* Interessen */}
              <div className="mb-6">
                <label className="block text-sm font-medium text-neutral-900 mb-2">
                  Interessen
                </label>
                <div className="grid grid-cols-2 gap-2">
                  {interessenOptionen.map(option => (
                    <button
                      key={option.id}
                      onClick={() => toggleInteresse(option.id)}
                      className={`px-4 py-2 text-sm font-medium rounded-md border transition-colors ${
                        interessen.includes(option.id)
                          ? 'bg-neutral-900 text-white border-neutral-900'
                          : 'bg-white text-neutral-700 border-neutral-300 hover:bg-neutral-50'
                      }`}
                    >
                      <span className="mr-2">{option.icon}</span>
                      {option.label}
                    </button>
                  ))}
                </div>
              </div>

              {/* Entfernung */}
              <div className="mb-6">
                <label className="block text-sm font-medium text-neutral-900 mb-2">
                  Entfernung
                </label>
                <div className="inline-flex rounded-md border border-neutral-200">
                  {[
                    { key: 'nah', label: '~3km' },
                    { key: 'mittel', label: '~8km' },
                    { key: 'erweitert', label: '~15km' }
                  ].map((option, idx) => (
                    <button
                      key={option.key}
                      onClick={() => setEntfernung(option.key)}
                      className={`px-4 py-2 text-sm font-medium ${
                        idx === 0 ? 'rounded-l-md' : ''
                      } ${idx === 2 ? 'rounded-r-md' : ''} ${
                        idx !== 2 ? 'border-r border-neutral-200' : ''
                      } ${
                        entfernung === option.key
                          ? 'bg-neutral-900 text-white'
                          : 'bg-white text-neutral-700 hover:bg-neutral-50'
                      }`}
                    >
                      {option.label}
                    </button>
                  ))}
                </div>
              </div>

              {/* Such-Button */}
              <button
                onClick={sucheVorschlaege}
                disabled={loading}
                className="w-full bg-neutral-900 text-white py-2.5 px-4 rounded-md font-medium hover:bg-neutral-800 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"
              >
                {loading ? (
                  <>
                    <div className="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
                    Suche l√§uft...
                  </>
                ) : (
                  <>
                    <Search size={16} />
                    Vorschl√§ge finden
                  </>
                )}
              </button>

              {!showApiInput && (
                <button
                  onClick={() => setShowApiInput(true)}
                  className="w-full mt-3 text-sm text-neutral-600 hover:text-neutral-900"
                >
                  API Einstellungen
                </button>
              )}
            </div>

            {/* Ergebnisse */}
            {vorschlaege.length > 0 && (
              <div className="space-y-3">
                <h2 className="text-lg font-semibold text-neutral-900 mb-3">
                  Vorschl√§ge f√ºr {ort}
                </h2>
                {vorschlaege.map((place) => (
                  <div
                    key={place.place_id}
                    className="bg-white border border-neutral-200 rounded-lg p-4 hover:border-neutral-300 transition-colors"
                  >
                    <div className="flex justify-between items-start mb-1">
                      <h3 className="font-medium text-neutral-900">{place.name}</h3>
                      {place.rating && (
                        <div className="flex items-center gap-1 text-sm">
                          <Star size={14} className="text-yellow-500 fill-yellow-500" />
                          <span className="font-medium text-neutral-900">{place.rating}</span>
                        </div>
                      )}
                    </div>
                    <p className="text-sm text-neutral-600 mb-2">{place.vicinity}</p>
                    {place.opening_hours && (
                      <p className="text-xs text-neutral-500">
                        {place.opening_hours.open_now ? 'Ge√∂ffnet' : 'Geschlossen'}
                      </p>
                    )}
                  </div>
                ))}
              </div>
            )}
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<VolkisTravelTipps />);
  </script>
</body>
</html>
