<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Volki's Travel Tipps</title>
  <script crossorigin src="https://unpkg.com/react@18.2.0/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone@7.23.5/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {}
      }
    }
  </script>
  <style>
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
        'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
        sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState } = React;

    function VolkisTravelTipps() {
      const [ort, setOrt] = useState('');
      const [zeitbudget, setZeitbudget] = useState('2h');
      const [interessen, setInteressen] = useState([]);
      const [entfernung, setEntfernung] = useState('mittel');
      const [vorschlaege, setVorschlaege] = useState([]);
      const [loading, setLoading] = useState(false);
      const [history, setHistory] = useState([]);
      const [showHistory, setShowHistory] = useState(false);

      const interessenOptionen = [
        { id: 'tourist_attraction', label: 'Sehensw√ºrdigkeiten', icon: 'üèõÔ∏è' },
        { id: 'park', label: 'Natur & Parks', icon: 'üå≥' },
        { id: 'restaurant', label: 'Restaurants', icon: 'üçΩÔ∏è' },
        { id: 'cafe', label: 'Caf√©s', icon: '‚òï' }
      ];

      const getCategoryInfo = (types) => {
        if (!types || types.length === 0) return null;
        
        // Match place types to our categories
        if (types.includes('tourist_attraction') || types.includes('point_of_interest')) {
          return { icon: 'üèõÔ∏è', label: 'Sehensw√ºrdigkeit' };
        }
        if (types.includes('park')) {
          return { icon: 'üå≥', label: 'Natur' };
        }
        if (types.includes('restaurant')) {
          return { icon: 'üçΩÔ∏è', label: 'Restaurant' };
        }
        if (types.includes('cafe')) {
          return { icon: '‚òï', label: 'Caf√©' };
        }
        return null;
      };

      // Load history from localStorage on mount
      React.useEffect(() => {
        try {
          const savedHistory = localStorage.getItem('volkis-search-history');
          if (savedHistory) {
            setHistory(JSON.parse(savedHistory));
          }
        } catch (error) {
          console.error('Error loading history:', error);
        }
      }, []);

      const toggleInteresse = (id) => {
        setInteressen(prev => 
          prev.includes(id) 
            ? prev.filter(i => i !== id)
            : [...prev, id]
        );
      };

      const sucheVorschlaege = async () => {
        if (!ort.trim()) {
          alert('Bitte einen Ort eingeben');
          return;
        }
        if (interessen.length === 0) {
          alert('Bitte mindestens eine Kategorie ausw√§hlen');
          return;
        }

        setLoading(true);
        setVorschlaege([]);

        try {
          const response = await fetch('/api/search', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              ort,
              interessen,
              entfernung
            })
          });

          const data = await response.json();

          if (data.success && data.results) {
            setVorschlaege(data.results);
            
            // Save to history
            const historyEntry = {
              id: Date.now(),
              ort,
              interessen: interessen.map(id => interessenOptionen.find(opt => opt.id === id)?.label).filter(Boolean),
              entfernung,
              zeitbudget,
              timestamp: new Date().toISOString(),
              resultsCount: data.results.length
            };
            
            const updatedHistory = [historyEntry, ...history].slice(0, 10); // Keep last 10 searches
            setHistory(updatedHistory);
            localStorage.setItem('volkis-search-history', JSON.stringify(updatedHistory));
          } else {
            alert(data.error || 'Es gab einen Fehler bei der Suche.');
          }
        } catch (error) {
          console.error('Fehler:', error);
          alert('Es gab einen Fehler bei der Suche. Bitte nochmal versuchen.');
        }

        setLoading(false);
      };

      return (
        <div className="min-h-screen bg-neutral-50 p-4 md:p-8">
          <div className="max-w-2xl mx-auto">
            {/* Header */}
            <div className="mb-8 flex justify-between items-start">
              <div>
                <h1 className="text-3xl font-semibold text-neutral-900 mb-2">
                  Volki's Travel Tipps
                </h1>
                <p className="text-neutral-600">Entdecke spannende Orte in deiner N√§he</p>
              </div>
              {history.length > 0 && (
                <button
                  onClick={() => setShowHistory(!showHistory)}
                  className="px-3 py-2 text-sm font-medium text-neutral-700 bg-white border border-neutral-300 rounded-md hover:bg-neutral-50 transition-colors flex items-center gap-2"
                >
                  <span>üìã</span>
                  <span className="hidden sm:inline">History</span>
                </button>
              )}
            </div>

            {/* History */}
            {showHistory && history.length > 0 && (
              <div className="bg-white border border-neutral-200 rounded-lg p-4 mb-6">
                <div className="flex justify-between items-center mb-3">
                  <h3 className="font-medium text-neutral-900">Letzte Suchen</h3>
                  <button
                    onClick={() => {
                      setHistory([]);
                      localStorage.removeItem('volkis-search-history');
                    }}
                    className="text-xs text-neutral-500 hover:text-neutral-700"
                  >
                    L√∂schen
                  </button>
                </div>
                <div className="space-y-2">
                  {history.map((entry) => (
                    <button
                      key={entry.id}
                      onClick={() => {
                        setOrt(entry.ort);
                        setZeitbudget(entry.zeitbudget);
                        setEntfernung(entry.entfernung);
                        setShowHistory(false);
                      }}
                      className="w-full text-left p-3 bg-neutral-50 hover:bg-neutral-100 rounded-md transition-colors"
                    >
                      <div className="flex justify-between items-start gap-2">
                        <div className="flex-1 min-w-0">
                          <p className="font-medium text-neutral-900 truncate">{entry.ort}</p>
                          <p className="text-xs text-neutral-600 mt-0.5">
                            {entry.interessen.join(', ')} ¬∑ {entry.entfernung === 'nah' ? '~3km' : entry.entfernung === 'mittel' ? '~8km' : '~15km'}
                          </p>
                        </div>
                        <span className="text-xs text-neutral-500 flex-shrink-0">
                          {new Date(entry.timestamp).toLocaleDateString('de-DE', { day: '2-digit', month: '2-digit' })}
                        </span>
                      </div>
                    </button>
                  ))}
                </div>
              </div>
            )}

            {/* Suchformular */}
            <div className="bg-white border border-neutral-200 rounded-lg p-6 mb-6">
              {/* Ort */}
              <div className="mb-6">
                <label className="block text-sm font-medium text-neutral-900 mb-2">
                  Ort
                </label>
                <input
                  type="text"
                  value={ort}
                  onChange={(e) => setOrt(e.target.value)}
                  placeholder="z.B. Dresden"
                  className="w-full px-3 py-2 border border-neutral-300 rounded-md focus:outline-none focus:ring-2 focus:ring-neutral-900 focus:border-transparent"
                />
              </div>

              {/* Zeitbudget */}
              <div className="mb-6">
                <label className="block text-sm font-medium text-neutral-900 mb-2">
                  Zeitbudget
                </label>
                <div className="inline-flex rounded-md border border-neutral-200">
                  {['1h', '2h', '3-4h'].map((zeit, idx) => (
                    <button
                      key={zeit}
                      onClick={() => setZeitbudget(zeit)}
                      className={`px-4 py-2 text-sm font-medium ${
                        idx === 0 ? 'rounded-l-md' : ''
                      } ${idx === 2 ? 'rounded-r-md' : ''} ${
                        idx !== 2 ? 'border-r border-neutral-200' : ''
                      } ${
                        zeitbudget === zeit
                          ? 'bg-neutral-900 text-white'
                          : 'bg-white text-neutral-700 hover:bg-neutral-50'
                      }`}
                    >
                      {zeit}
                    </button>
                  ))}
                </div>
              </div>

              {/* Interessen */}
              <div className="mb-6">
                <label className="block text-sm font-medium text-neutral-900 mb-2">
                  Interessen
                </label>
                <div className="grid grid-cols-2 gap-2">
                  {interessenOptionen.map(option => (
                    <button
                      key={option.id}
                      onClick={() => toggleInteresse(option.id)}
                      className={`px-3 py-2.5 text-sm font-medium rounded-md border transition-colors flex items-center justify-center gap-2 ${
                        interessen.includes(option.id)
                          ? 'bg-neutral-900 text-white border-neutral-900'
                          : 'bg-white text-neutral-700 border-neutral-300 hover:bg-neutral-50'
                      }`}
                    >
                      <span className="text-base flex-shrink-0">{option.icon}</span>
                      <span className="text-xs sm:text-sm truncate">{option.label}</span>
                    </button>
                  ))}
                </div>
              </div>

              {/* Entfernung */}
              <div className="mb-6">
                <label className="block text-sm font-medium text-neutral-900 mb-2">
                  Entfernung
                </label>
                <div className="inline-flex rounded-md border border-neutral-200">
                  {[
                    { key: 'nah', label: '~3km' },
                    { key: 'mittel', label: '~8km' },
                    { key: 'erweitert', label: '~15km' }
                  ].map((option, idx) => (
                    <button
                      key={option.key}
                      onClick={() => setEntfernung(option.key)}
                      className={`px-4 py-2 text-sm font-medium ${
                        idx === 0 ? 'rounded-l-md' : ''
                      } ${idx === 2 ? 'rounded-r-md' : ''} ${
                        idx !== 2 ? 'border-r border-neutral-200' : ''
                      } ${
                        entfernung === option.key
                          ? 'bg-neutral-900 text-white'
                          : 'bg-white text-neutral-700 hover:bg-neutral-50'
                      }`}
                    >
                      {option.label}
                    </button>
                  ))}
                </div>
              </div>

              {/* Such-Button */}
              <button
                onClick={sucheVorschlaege}
                disabled={loading}
                className="w-full bg-neutral-900 text-white py-2.5 px-4 rounded-md font-medium hover:bg-neutral-800 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"
              >
                {loading ? (
                  <>
                    <div className="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
                    Suche l√§uft...
                  </>
                ) : (
                  <>
                    <span>üîç</span>
                    Vorschl√§ge finden
                  </>
                )}
              </button>
            </div>

            {/* Ergebnisse */}
            {vorschlaege.length > 0 && (
              <div className="space-y-3">
                <h2 className="text-lg font-semibold text-neutral-900 mb-3">
                  Vorschl√§ge f√ºr {ort}
                </h2>
                {vorschlaege.map((place) => {
                  const categoryInfo = getCategoryInfo(place.types);
                  const googleMapsUrl = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(place.name)}&query_place_id=${place.place_id}`;
                  
                  return (
                    <a
                      key={place.place_id}
                      href={googleMapsUrl}
                      target="_blank"
                      rel="noopener noreferrer"
                      className="block bg-white border border-neutral-200 rounded-lg p-4 hover:border-neutral-400 hover:shadow-sm transition-all cursor-pointer"
                    >
                      <div className="flex justify-between items-start gap-3 mb-2">
                        <div className="flex-1 min-w-0">
                          <div className="flex items-center gap-2 mb-1">
                            {categoryInfo && (
                              <span className="flex-shrink-0 px-2 py-0.5 bg-neutral-100 text-neutral-700 rounded text-xs font-medium flex items-center gap-1">
                                <span>{categoryInfo.icon}</span>
                                <span>{categoryInfo.label}</span>
                              </span>
                            )}
                          </div>
                          <h3 className="font-medium text-neutral-900 truncate">{place.name}</h3>
                        </div>
                        {place.rating && (
                          <div className="flex items-center gap-1 text-sm flex-shrink-0">
                            <span className="text-yellow-500">‚≠ê</span>
                            <span className="font-medium text-neutral-900">{place.rating}</span>
                          </div>
                        )}
                      </div>
                      <p className="text-sm text-neutral-600 mb-2">{place.vicinity}</p>
                      <div className="flex items-center justify-between">
                        {place.opening_hours && (
                          <span className={`text-xs font-medium ${place.opening_hours.open_now ? 'text-green-600' : 'text-neutral-500'}`}>
                            {place.opening_hours.open_now ? '‚óè Ge√∂ffnet' : '‚óã Geschlossen'}
                          </span>
                        )}
                        <span className="text-xs text-neutral-500 ml-auto">
                          Auf Google Maps √∂ffnen ‚Üí
                        </span>
                      </div>
                    </a>
                  );
                })}
              </div>
            )}
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<VolkisTravelTipps />);
  </script>
</body>
</html>
